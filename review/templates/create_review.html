{% extends 'base.html' %}

{% block title %}Create Review{% endblock %}

{% block content %}
<h1>Create a New Review</h1>
<div class="reviewForm">
<form method="post">
    <div id="review-form" class="mb-2 mx-3">
    {% csrf_token %}
    <fieldset class="bottom-border mb-2">
        <legend>Album Information:</legend>
        {{ album_form.existing_album.label_tag }} {{ album_form.existing_album }}
        <p>Or enter new album details:</p>
        {{ album_form.title.label_tag }} {{ album_form.title }}
        {{ album_form.artist.label_tag }} {{ album_form.artist }}
        {{ album_form.image_url.label_tag }} {{ album_form.image_url }}
        {{ album_form.description.label_tag }} {{ album_form.description }}
    </fieldset>
    <fieldset>
        <legend>Review:</legend>
        {{ review_form.as_p }}
    </fieldset>
    <button type="submit">Submit</button></div>
</form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get references to the existing album select element and the title and artist input fields
        const existingAlbumSelect = document.querySelector('select[name="existing_album"]');
        const titleInput = document.querySelector('input[name="title"]');
        const artistInput = document.querySelector('input[name="artist"]');
        const imageUrlInput = document.querySelector('input[name="image_url"]');
        const descriptionInput = document.querySelector('textarea[name="description"]');

        // Add an event listener to the existing album select element
        existingAlbumSelect.addEventListener('change', function () {
            const selectedAlbumId = this.value;
            if (selectedAlbumId) {
                // Fetch album details from the server if an album is selected
                fetch(`/api/albums/${selectedAlbumId}/`)
                    .then(response => response.json())
                    .then(data => {
                        // Populate the input fields with the fetched album details
                        titleInput.value = data.title;
                        artistInput.value = data.artist;
                        imageUrlInput.value = data.image_url;
                        descriptionInput.value = data.description;
                    });
            } else {
                // Clear the input fields if no album is selected
                titleInput.value = '';
                artistInput.value = '';
                imageUrlInput.value = '';
                descriptionInput.value = '';
            }
        });
    });
</script>
{% endblock %}